@echo off
title SCUM Server Manager - Gerenciador de Senhas
color 0A
mode con: cols=80 lines=25

:menu
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                    SCUM SERVER MANAGER - GERENCIADOR DE SENHAS           ‚ïë
echo  ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
echo  ‚ïë                                                                          ‚ïë
echo  ‚ïë  [1] Alterar senha de usu√°rio                                           ‚ïë
echo  ‚ïë  [2] Listar usu√°rios cadastrados                                        ‚ïë
echo  ‚ïë  [3] Criar novo usu√°rio                                                 ‚ïë
echo  ‚ïë  [4] Desativar usu√°rio                                                  ‚ïë
echo  ‚ïë  [5] Ativar usu√°rio                                                     ‚ïë
echo  ‚ïë  [6] Sair                                                               ‚ïë
echo  ‚ïë                                                                          ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
set /p opcao=Escolha uma op√ß√£o (1-6): 

if "%opcao%"=="1" goto alterar_senha
if "%opcao%"=="2" goto listar_usuarios
if "%opcao%"=="3" goto criar_usuario
if "%opcao%"=="4" goto desativar_usuario
if "%opcao%"=="5" goto ativar_usuario
if "%opcao%"=="6" goto sair
goto menu

:alterar_senha
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                           ALTERAR SENHA DE USU√ÅRIO                      ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo  Usu√°rios dispon√≠veis:
echo.
node -e "const fs = require('fs'); const users = JSON.parse(fs.readFileSync('src/data/auth/users.json', 'utf8')); users.users.forEach(user => console.log('  - ' + user.username + (user.active ? ' (Ativo)' : ' (Inativo)')));"
echo.
set /p username=Digite o nome do usu√°rio: 
set /p newpassword=Digite a nova senha: 
set /p confirmpassword=Confirme a nova senha: 

if not "%newpassword%"=="%confirmpassword%" (
    echo.
    echo  ‚ùå ERRO: As senhas n√£o coincidem!
    echo.
    pause
    goto alterar_senha
)

echo.
echo  üîß Gerando nova senha para: %username%
echo.

node scripts/generate-password.js %username% %newpassword%

if %errorlevel% equ 0 (
    echo.
    echo  ‚úÖ Senha alterada com sucesso!
    echo  üìù Nova senha: %newpassword%
    echo.
) else (
    echo.
    echo  ‚ùå Erro ao alterar senha!
    echo.
)

pause
goto menu

:listar_usuarios
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                           USU√ÅRIOS CADASTRADOS                          ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
node -e "const fs = require('fs'); const users = JSON.parse(fs.readFileSync('src/data/auth/users.json', 'utf8')); console.log('ID\t\tUsu√°rio\t\t\tRole\t\tStatus\t\t√öltimo Login'); console.log('‚îÄ'.repeat(80)); users.users.forEach(user => { const status = user.active ? '‚úÖ Ativo' : '‚ùå Inativo'; const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString('pt-BR') : 'Nunca'; console.log(`${user.id}\t\t${user.username.padEnd(16)}\t${user.role.padEnd(12)}\t${status}\t${lastLogin}`); });"
echo.
pause
goto menu

:criar_usuario
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                           CRIAR NOVO USU√ÅRIO                           ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
set /p newusername=Digite o nome do novo usu√°rio: 
set /p newuserpassword=Digite a senha do novo usu√°rio: 
set /p newuserrole=Digite o role (admin/user): 

echo.
echo  üîß Criando novo usu√°rio: %newusername%
echo.

node -e "
const fs = require('fs');
const bcrypt = require('bcrypt');
const path = require('path');

const usersPath = path.join('src', 'data', 'auth', 'users.json');
const usersData = JSON.parse(fs.readFileSync(usersPath, 'utf8'));

// Verificar se usu√°rio j√° existe
const existingUser = usersData.users.find(u => u.username === process.argv[2]);
if (existingUser) {
    console.log('‚ùå ERRO: Usu√°rio j√° existe!');
    process.exit(1);
}

// Gerar hash da senha
const saltRounds = 10;
const passwordHash = bcrypt.hashSync(process.argv[3], saltRounds);

// Criar novo usu√°rio
const newUser = {
    id: (usersData.users.length + 1).toString(),
    username: process.argv[2],
    password: passwordHash,
    role: process.argv[4] || 'user',
    created_at: new Date().toISOString(),
    last_login: null,
    active: true
};

usersData.users.push(newUser);

// Salvar arquivo
fs.writeFileSync(usersPath, JSON.stringify(usersData, null, 2));

console.log('‚úÖ Usu√°rio criado com sucesso!');
console.log('üìù Detalhes:');
console.log('   - Usu√°rio:', process.argv[2]);
console.log('   - Role:', process.argv[4] || 'user');
console.log('   - Status: Ativo');
" %newusername% %newuserpassword% %newuserrole%

if %errorlevel% equ 0 (
    echo.
    echo  ‚úÖ Usu√°rio criado com sucesso!
    echo.
) else (
    echo.
    echo  ‚ùå Erro ao criar usu√°rio!
    echo.
)

pause
goto menu

:desativar_usuario
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                           DESATIVAR USU√ÅRIO                             ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo  Usu√°rios ativos:
echo.
node -e "const fs = require('fs'); const users = JSON.parse(fs.readFileSync('src/data/auth/users.json', 'utf8')); users.users.filter(user => user.active).forEach(user => console.log('  - ' + user.username));"
echo.
set /p username=Digite o nome do usu√°rio para desativar: 

node -e "
const fs = require('fs');
const path = require('path');

const usersPath = path.join('src', 'data', 'auth', 'users.json');
const usersData = JSON.parse(fs.readFileSync(usersPath, 'utf8'));

const user = usersData.users.find(u => u.username === process.argv[2]);
if (!user) {
    console.log('‚ùå ERRO: Usu√°rio n√£o encontrado!');
    process.exit(1);
}

if (!user.active) {
    console.log('‚ùå ERRO: Usu√°rio j√° est√° inativo!');
    process.exit(1);
}

user.active = false;

fs.writeFileSync(usersPath, JSON.stringify(usersData, null, 2));

console.log('‚úÖ Usu√°rio desativado com sucesso!');
" %username%

if %errorlevel% equ 0 (
    echo.
    echo  ‚úÖ Usu√°rio desativado com sucesso!
    echo.
) else (
    echo.
    echo  ‚ùå Erro ao desativar usu√°rio!
    echo.
)

pause
goto menu

:ativar_usuario
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                            ATIVAR USU√ÅRIO                               ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo  Usu√°rios inativos:
echo.
node -e "const fs = require('fs'); const users = JSON.parse(fs.readFileSync('src/data/auth/users.json', 'utf8')); users.users.filter(user => !user.active).forEach(user => console.log('  - ' + user.username));"
echo.
set /p username=Digite o nome do usu√°rio para ativar: 

node -e "
const fs = require('fs');
const path = require('path');

const usersPath = path.join('src', 'data', 'auth', 'users.json');
const usersData = JSON.parse(fs.readFileSync(usersPath, 'utf8'));

const user = usersData.users.find(u => u.username === process.argv[2]);
if (!user) {
    console.log('‚ùå ERRO: Usu√°rio n√£o encontrado!');
    process.exit(1);
}

if (user.active) {
    console.log('‚ùå ERRO: Usu√°rio j√° est√° ativo!');
    process.exit(1);
}

user.active = true;

fs.writeFileSync(usersPath, JSON.stringify(usersData, null, 2));

console.log('‚úÖ Usu√°rio ativado com sucesso!');
" %username%

if %errorlevel% equ 0 (
    echo.
    echo  ‚úÖ Usu√°rio ativado com sucesso!
    echo.
) else (
    echo.
    echo  ‚ùå Erro ao ativar usu√°rio!
    echo.
)

pause
goto menu

:sair
cls
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                           OBRIGADO POR USAR!                            ‚ïë
echo  ‚ïë                    SCUM SERVER MANAGER - GERENCIADOR DE SENHAS          ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo  üëã Saindo do sistema...
echo.
timeout /t 3 /nobreak >nul
exit 